name: Release
on:
  push: {}
#    branches:
#      - main
#    paths:
#      - src/**
#      - pyproject.toml
#      - requirements.txt

jobs:
  update-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - name: Install hatch
        run: pip install hatch
      - run: cat src/pycli/__init__.py
      - run: hatch version
      - run: hatch version patch
      - run: cat src/pycli/__init__.py
      - run: |
          echo "GITHUB_TOKEN: $GITHUB_TOKEN"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - run: |
          set -x
          echo Before setting envs
          echo GIT_COMMITTER_NAME: $GIT_COMMITTER_NAME
          echo GIT_COMMITTER_EMAIL: $GIT_COMMITTER_EMAIL
          git config user.name
          git config user.email
        continue-on-error: true
      - run: |
          set -x
          echo With envs
          echo GIT_COMMITTER_NAME: $GIT_COMMITTER_NAME
          echo GIT_COMMITTER_EMAIL: $GIT_COMMITTER_EMAIL
          git config user.name
          git config user.email
        continue-on-error: true
        env:
          GIT_COMMITTER_NAME: github-actions[bot]
          GIT_COMMITTER_EMAIL: 41898282+github-actions[bot]@users.noreply.github.com

  test:
    runs-on: ubuntu-latest
    needs: [update-version]
    steps:
      - uses: actions/checkout@v6
      - run: cat src/pycli/__init__.py
